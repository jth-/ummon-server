#!/usr/bin/env node

var optimist = require('optimist');
var path = require('path');
var fs = require('fs');


// Expose metadata for helmsman
exports.command = {
    description: 'Stop the running ummon server'
};


if (require.main === module) {
  console.log(''); // Some padding for niceness

  var argv = optimist.usage(exports.command.description, {
    'force': {
      description: 'Really kill the prcoess. Don\'t play nice',
      boolean: true,
      short: 'f',
    }
  }).argv;

  if (argv.help) {
    return console.log(optimist.help());
  }

  // Figure out paths and signals
  var uu = require(path.resolve(__dirname, '../lib/utils.js'))
  var config = uu.loadConfig(argv);
  var pidPath = uu.pidPath(config);

  var SIG = (argv.force) ? 'SIGKILL' : 'SIGINT'

  // Kill the process and delete it's pid file
  process.kill(fs.readFileSync(pidPath, { encoding: 'utf8' }), SIG);
  console.log('%s sent to ummon-server', SIG);
  fs.unlinkSync(pidPath);
}